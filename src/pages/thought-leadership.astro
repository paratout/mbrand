---
import { getCollection } from 'astro:content';
import BaseLayout from '../layouts/BaseLayout.astro';
import Hero from '../components/Hero.jsx';
import ArticlePreview from '../components/ArticlePreview.jsx';

// Get all blog posts, sorted by date
const allPosts = await getCollection('blog', ({ data }) => {
  return data.draft !== true;
});

const sortedPosts = allPosts.sort((a, b) => 
  b.data.date.valueOf() - a.data.date.valueOf()
);

// Pagination (simple version - 9 posts per page)
const postsPerPage = 9;
const currentPage = 1;
const totalPages = Math.ceil(sortedPosts.length / postsPerPage);
const paginatedPosts = sortedPosts.slice(0, postsPerPage);
---

<BaseLayout 
  title="Thought Leadership - Insights on Enterprise Architecture & Digital Transformation"
  description="Articles and insights on enterprise architecture, digital transformation, cloud strategy, and technology leadership."
  path="/thought-leadership"
>
  <Hero 
    title="Thought Leadership"
    subtitle="Insights on Enterprise Architecture, Digital Transformation & Technology Trends"
    client:load
  />

  <section class="section-spacing">
    <div class="container-custom">
      {paginatedPosts.length === 0 ? (
        <div class="text-center py-16">
          <div class="text-6xl mb-4">üìù</div>
          <h2 class="text-2xl font-heading font-bold mb-4 text-slate-900 dark:text-white">
            Articles Coming Soon
          </h2>
          <p class="text-slate-600 dark:text-slate-300 max-w-md mx-auto">
            I'm currently working on new content. Check back soon for insights on 
            enterprise architecture and digital transformation.
          </p>
        </div>
      ) : (
        <>
          <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8 mb-12">
            {paginatedPosts.map((post) => (
              <ArticlePreview
                slug={post.slug}
                title={post.data.title}
                excerpt={post.data.description}
                date={post.data.date}
                image={post.data.image}
                tags={post.data.tags}
              />
            ))}
          </div>

          {/* Pagination */}
          {totalPages > 1 && (
            <div class="flex justify-center items-center space-x-4">
              <button 
                disabled={currentPage === 1}
                class="px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors"
              >
                Previous
              </button>
              <span class="text-slate-600 dark:text-slate-400">
                Page {currentPage} of {totalPages}
              </span>
              <button 
                disabled={currentPage === totalPages}
                class="px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors"
              >
                Next
              </button>
            </div>
          )}
        </>
      )}
    </div>
  </section>

  <!-- Newsletter CTA -->
  <section class="section-spacing bg-primary text-white">
    <div class="container-custom text-center">
      <h2 class="text-3xl md:text-4xl font-heading font-bold mb-6">
        Stay Updated
      </h2>
      <p class="text-xl mb-8 max-w-2xl mx-auto opacity-90">
        Get notified when I publish new articles on enterprise architecture, 
        digital transformation, and technology leadership.
      </p>
      <a href="/contact" class="btn-secondary inline-block">
        Subscribe to Updates
      </a>
    </div>
  </section>
</BaseLayout>
